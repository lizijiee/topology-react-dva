## 二维组态设计

### 1. 需求统计

| 序号 |                           具体需求                           |
| :--: | :----------------------------------------------------------: |
|  1   | 需要有用户权限体系，包括组态图的查看权限和编辑构件库的权限。 |
|  2   |       构件库需要可编辑，包括构件分类和构件的上传命名。       |
|  3   |      需要有在线画组态构件的功能，并可以存储到构件库中。      |
|  4   | 组态构件需要能设定连接点的功能，固定连接点，其他位置不允许进行连接。 |
|  5   |                 组态构件需要能进行动效设计。                 |
|  6   |        组态构件需要能对接实时数据，并支持数据的模拟。        |
|  7   | （待定）需要根据客户的构件列表绘制一套预置的2.5D组态构件图库 |

需求澄清：
0.react版本号。
1.用户权限分为两种，一种为普通用户，一种为admin，首页展示相同，普通用户进入项目，左侧编辑构件库不进行显示。仅可以查看首页图文库。
2.构件库中构建分类可编辑，，
构件上传流程：左侧分为构件库和我的构件（不分类只有一个添加按钮），点击我的构建**添加按钮** => 添加右侧变成空白url进入详情页?c=true&class=架构拓扑图 => 文件/保存 进入我的构件。右侧可以进行构件名称及构件类别设置，下拉框可以添加类别。
导入构件也直接显示在画布上，保存时候根据url保存到指定类别中，右侧选择类别及名称进行创建。
图片上传后可以进行预览另一侧选中组件后可以进行添加到节点中。
创建分为**图文设置**和**组件设置**

3.在线画组件库就是构件库的生成过程，<font color="red">具体哪些功能？？自己绘制浏览器无法捕捉呀，而且鼠标移动持续记录浏览器也受不了。</font>
4.固定连接点，其它位置禁止连接，使用过程中的操作问题，跟固定连接点需求没关系，正常设置连接点进行连接就好了。
5.<font color="red">自定义动画效果功能。</font>
6.保存事件中Websocket事件类行。

功能分析：
右侧菜单：【组件设置】，节点中【事件功能】部分

开发进程：
 自定义iconfont示例

#### 1.1 搭建Topology组件平台（静态）

##### 1.1.1 安装UmiJS

> yarn global add umi 

##### 1.1.1 安装UmiJS脚手架

> 创建文件夹topology-react
> yarn create umi 
> 选择app创建一个umi应用
> 不选择typeScript
> 空格选择dva 
> 完成项目创建





> [Umi 小白纪实（一）—— 创建项目&常用配置](https://www.cnblogs.com/wisewrong/p/12160671.html)



> 项目静态页面初步完成。



#### 1.2 权限体系

![flow-account.png](https://cdn.nlark.com/yuque/0/2019/png/179380/1566982730044-9eabaa05-2059-43f9-9981-aef8fe7f06a5.png)

权限控制算是软件项目中的常用功能了。在网站中，权限控制一般分为两个维度：页面级别和页面元素级别。页面元素粒度的权限控制，使用高阶组件进行封装。

```javascript
export  let wrapAuth = ComposedComponent =>class WrapComponent extends Component {
    // 构造
    constructor(props) {
      super(props);
    }
 
    static propTypes = {
      auth:PropTypes.string.isRequired,
    };
 
    render() {
      if (tool.getAuth(this.props.auth)) {
        return <ComposedComponent  { ...this.props} />;
      } else {
        return null;
      }
    }

```

[react高阶组件之经典应用：权限控制](https://blog.csdn.net/qq_40963664/article/details/80744726?utm_source=blogxgwz7)
[react-router4.x 路由权限控制](https://blog.csdn.net/qq_40963664/article/details/80701968)

> topology-vue 使用指南含权限部分
> [手摸手，带你用vue撸后台 系列二(登录权限篇)](https://juejin.cn/post/6844903478880370701)
> [权限项目在线地址](https://panjiachen.github.io/vue-element-admin/#/permission/directive)

#### 1.3 构件库开发

> 构件库需要可编辑，包括构件分类和构件的上传命名。

#### 1.4 组态构建设置连接点

#### 1.5 权限体系分析

#### 1.6 权限体系分析



### 5. 参考资料

>1. 目前已有基础设计器和构件库，地址：https://2d.happybim.com/workspace
>2. 组态网站地址：http://topology.le5le.com/workspace
>3. 优化，但是嵌套项目自身应该存在loading，其它功能是否也存在类似情况，项目自身存在，属于公共用功能[dva-loading 实践用法](https://blog.csdn.net/qq_40963664/article/details/80697708)